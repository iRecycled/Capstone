<html>
    <head>
        <title>username's profile</title>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- jQuery first, then Popper.js, Bootstrap JS, Bootstrap CSS, sideBar JS -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
            crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
            crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
            crossorigin="anonymous">
        <!-- Font Awesome JS -->
        <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous"></script>
        <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous"></script>
        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">
        <!-- Scrollbar Custom CSS -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">
        <!--Custom CSS-->
        <link rel="stylesheet" href="style.css">
        <link rel="stylesheet" href="profilePageStyle.css">
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script>
            function loadServer(serverID) {
                localStorage.setItem("serverID", serverID);
                //window.location.href = 'http://144.13.22.61/CS458SP19/Team1/Capstone/chat.html';
                console.log("TEST");
            }
            $(document).ready(function(){
                $("#createServerBtn").click(function(e){
                    e.preventDefault();
                    $.ajax({
                    type: "post",
                    url: "server.php",
                    data: {username: localStorage.getItem('username'), servername: document.getElementById("newServerName").value},
                    success: function(result) {
                        window.location.href = 'http://144.13.22.61/CS458SP19/Team1/Capstone/home.html';
                    },
                    error: function(result) {
                        window.location.href = 'http://144.13.22.61/CS458SP19/Team1/Capstone/profile_page.html';
                    }
                })
                })
            })
            $(document).ready(function(){
                $("#changePasswordBtn").click(function(e){
                    e.preventDefault();
                    $.ajax({
                    type: "post",
                    url: "changePassword.php",
                    data: {username: localStorage.getItem('username'), password: document.getElementById("oldPass").value, newPassword: document.getElementById("newPass").value, confirmNewPassword: document.getElementById("confirmNewPass").value},
                    success: function(result) {
                        window.location.href = 'http://144.13.22.61/CS458SP19/Team1/Capstone/home.html';
                    },
                    error: function(result) {
                        window.location.href = 'http://144.13.22.61/CS458SP19/Team1/Capstone/profile_page.html';
                    }
                })
                })
            })
            $(document).ready(function(){
                $.ajax({
                    type: "post",
                    url: "getServerList.php",
                    data: {username: localStorage.getItem('username')},
                    success: function(data) {
                        obj = JSON.parse(data);
                        for( var x in obj) {
                            let privateServerList = document.getElementById("pageSubmenu");
                            let listItem = document.createElement("li");
                            let link = document.createElement("a");
                            let text = document.createTextNode(obj[x].ServerName);
                            link.id = obj[x].ServerName;
                            link.onclick = function() {
                                alert(this.id);
                            };
                            link.appendChild(text);
                            listItem.appendChild(link);
                            privateServerList.appendChild(listItem);
                        }
                    },
                    error: function(data) {
                        console.log("fail");
                    }
                })
                $.ajax({
                    type: "post",
                    url: "userInfo.php",
                    data: {username: localStorage.getItem('username')},
                    success: function(data) {
                        console.log(data);
                        obj = JSON.parse(data);
                        console.log(obj);
                        document.getElementById("userName").innerHTML = obj.name;
                        document.getElementById("email").innerHTML = obj.email;
                        document.getElementById("chatCount").innerHTML = obj.chatCount;
                        document.getElementById("privateCount").innerHTML = obj.privateCount;
                        document.getElementById("otherData").innerHTML = "nothing right now";
                    },
                    error: function(data) {
                        console.log("fail");
                    }
                })
            })
        </script>
    </head>
    <body>
        <!-- Nav Bar-->
        <nav class="navbar navbar-expand navbar-dark bg-dark fixed-top">
            <ul class="navbar-nav mr-auto">
                <a class="nav-item nav-link active" href="home.html">Home <span class="sr-only">(current)</span></a>
            </ul>
    
            <ul class="navbar-nav mr-auto ">
                <a class="navbar-brand mb-0 h1" href="#">TerryChat <span class="sr-only">(current)</span></a>
            </ul>
    
            <ul class="navbar-nav right">
                <a class="nav-item nav-link active" href="#" data-toggle="modal" data-target="#changePasswordModal">ChangePassword <span class="sr-only">(current)</span></a>
                <a class="nav-item nav-link active" href="home.html">Logout <span class="sr-only">(current)</span></a>
                <a class="nav-item nav-link active" href="profile_page.html" id="username">       
                    <script>
                        document.getElementById("username").innerHTML = '<i class="fas fa-user-circle" aria-hidden="true" ></i>' + " " + localStorage.getItem("username");
                    </script>
                <span class="sr-only">(current)</span></a>
            </ul>
        </nav>
        <div class="wrapper">
            <!-- Sidebar -->
            <nav id="sidebar" class="bg-dark navbar-text text-center">
                <div class="sidebar-header">
                    <h4><a href="chat.html"><u>My Chatrooms</u></a></h4>
                </div>
        
                <ul class="list-unstyled components">
                    <li class="active">
                        <a href="#homeSubmenu" data-toggle="collapse" aria-expanded="true" class="dropdown-toggle">Public Chatrooms</a>
                        <ul class="collapse list-unstyled" id="homeSubmenu">
                            <li>
                                <a href="#">Chat 1</a>
                            </li>
                            <li>
                                <a href="#">Chat 2</a>
                            </li>
                            <li>
                                <a href="#">Chat 3</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="#pageSubmenu" data-toggle="collapse" aria-expanded="true" class="dropdown-toggle">Private Chatrooms</a>
                        <ul class="collapse list-unstyled" id="pageSubmenu" name="privateServers">
                            
                        </ul>
                    </li>
                </ul>
                <div class="sidebar-header">
                        <h4><a href="Instant_messages.html"><u>Instant Messages</u></a></h4>
                </div>
                <ul class="list-unstyled components">
                    <li class="active">
                        <a href="#homeSubmenu" data-toggle="collapse" aria-expanded="true" class="dropdown-toggle">Friends</a>
                            <ul class="collapse list-unstyled" id="homeSubmenu">
                                <li>
                                    <a href="#">User1</a>
                                </li>
                                <li>
                                    <a href="#">User2</a>
                                </li>
                                <li>
                                    <a href="#">User3</a>
                                </li>
                            </ul>
                    </li> 
                </ul>
                <div class="sidebar-header">
                        <h4><u>Features</u></h4>
                </div>
                <ul class="list-instyled components">
                    <li>
                        <a href="#" id="newServerLink" data-toggle="modal" data-target="#newPrivateServerModal">Add new server</a>
                    </li>
                    <li>
                        <a href="#" data-toggle="modal" data-target="#deletePrivateServerModal">Delete server</a>
                    </li>
                    <li>
                        <a href="#">Invite to server</a>
                    </li>
                </ul>
                <ul class="list-unstyled components">    
                    <li>
                        <a href="#">About</a>
                    </li>
                    <li>
                        <a href="#">Server</a>
                    </li>
                </ul> 
        
            </nav>
            <!--Page content-->
            <div class="container">
                <div class="row" >
                    <div class="col-lg-4" id="firstRow">
                        <i class="fa fa-user-circle" aria-hidden="true" id="defaultProfilePic"></i> 
                        <h5><script>localStorage.getItem("username");</script></h5>
                    </div>

                    <div class="col-lg-8">
                        <p id="intro">Welcome to your profile page! Here you can see information about your profile and make some changes.
                            You can also use the sidebar to travel throughout TerryChat into private and public chatrooms as well as instant messaging 
                            specific users. The sidebar also includes features for adding and deleting private servers.
                        </p>
                    </div>
                </div>
            

                        <table class="table table-bordered">
                            <thead class="thead-dark">
                                <tr>
                                    <th colspan="4" id="tableTitle">Account Information</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td scope="row" class="tableLabel">Username</td>
                                    <td class="tableInfo" id="userName">username from database</td>
                                    <td scope="row" class="tableLabel">Private Servers Owned</td>
                                    <td class="tableInfo" id="privateCount">0</td>
                                </tr>
                                <tr>
                                    <td scope="row" class="tableLabel">Email</td>
                                    <td class="tableInfo" id="email">email from database</td>
                                    <td scope="row" class="tableLabel">Chats participated in</td>
                                    <td class="tableInfo" id="chatCount">0</td>
                                </tr>
                                <tr>
                                    <td scope="row" class="tableLabel" colspan="2">Anything else</td>
                                    <td class="tableInfo" colspan="2" id="otherData">could add more rows here</td>
                                </tr>
                            </tbody>
                        </table>
                  
        </div>
           <!-- Modal changePassword-->
        <div class="modal fade" id="changePasswordModal" tabindex="-1" role="dialog"  aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header text-center">
                            <h4 class="modal-title w-100 font-weight-bold" id="changePasswordModal">Change Password</h4>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        
                        <div class="modal-body mx-3">
                            <div class="md-form mb-4">
                                <i class="fas fa-lock prefix grey-text"></i>
                                <label data-error="wrong" data-success="right" for="defaultForm-email">Old Password</label>
                                <input type="password" name="oldPass" id="oldPass" class="form-control validate">
                            </div>

                            <div class="md-form mb-4">
                                <i class="fas fa-lock prefix grey-text"></i>
                                <label data-error="wrong" data-success="right" for="defaultForm-pass">New Password</label>
                                <input type="password" name="newPass" id="newPass" class="form-control validate">
                            </div>

                            <div class="md-form mb-4">
                                    <i class="fas fa-lock prefix grey-text"></i>
                                    <label data-error="wrong" data-success="right" for="defaultForm-pass">Confirm New Password</label>
                                    <input type="password" name="confirmNewPass" id="confirmNewPass" class="form-control validate">
                            </div>
                            <div class="md-form mb-4">
                                <div class="errorMsg"></div>
                            </div>
                        </div>
                        <div class="modal-footer d-flex justify-content-center">
                            <button type="button" class="btn btn-success" id="changePasswordBtn">Change password</button>
                            <button type="button" class= "btn btn-primary" id="forgotPasswordBtn">Forgot Password</button>
                            <button type="button" class="btn btn-default" data-dismiss="modal" >Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
            <!--Add a new private Server Modal-->
            <div class="modal fade" id="newPrivateServerModal" tabindex="-1" role="dialog"  aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header text-center">
                            <h4 class="modal-title w-100 font-weight-bold" id="newPrivateServerModalTitle">Create a new Server</h4>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                            
                        <div class="modal-body mx-3">
                            <div class="md-form mb-4">
                                <label data-error="wrong" data-success="right">New server name</label>
                                <input type="text" name="newServerName" id="newServerName" maxlength="20" class="form-control validate">
                            </div>
                        </div>
                        <div class="modal-footer d-flex justify-content-center">
                            <button type="button" class="btn btn-success" id="createServerBtn">Create Server</button>
                            <button type="button" class="btn btn-danger" data-dismiss="modal" >Cancel</button>
                        </div>
                    </div>
                </div>
            </div>    

            <!--Delete an existing private Server Modal-->
            <div class="modal fade" id="deletePrivateServerModal" tabindex="-1" role="dialog"  aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header text-center">
                                <h4 class="modal-title w-100 font-weight-bold" id="deletePrivateServerModal">Delete an existing Server</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            
                            <div class="modal-body mx-3">
                                <div class="md-form mb-4">
                                    <label data-error="wrong" data-success="right" for="defaultForm-email">Name of Server to delete</label>
                                    <input type="text" id="existingServerName" class="form-control validate">
                                </div>
                            </div>
                            </div>
                            
                            <div class="modal-body mx-3">
                                <div class="form-group">
                                    <label for="form_name">Server Name</label>>
                                    <input id="form_name" type="text" name="servername" class="form-control" placeholder="Please enter the name of your server" required="required" data-error="server name is required.">
                                    <div class="help-block with-errors"></div>
                                </div>
                            </div>
                            <div class="modal-footer d-flex justify-content-center">
                                <input type="submit" value="Create Server" name="submit">
                                <button type="button" class="btn btn-danger" data-dismiss="modal" >Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" 
        crossorigin="anonymous"></script>

    </body>
</html>